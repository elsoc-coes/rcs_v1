pos_id = factor(car::recode(pos_id, "6 = 5; -999:-888 = 6"),
levels = 1:6,
labels = c("Apruebo", "Rechazo", "Nulo/Blanco",
"No vota", "No lo he\ndecidido", "NS/NR")),
ola = factor(ola,
levels = 5:6,
labels = c("Plebiscito de\nEntrada\n2020",
"Plebiscito de\nSalida\n2022"))) %>%
mutate(pp_4 = factor(pp_4,
labels = c("Votante\nCrónico", "Desafecto", "No-Votante\nCrónico", "Activado"))) %>%
survey_design_elsoc() %>%
svytable(~ pos_id + ola + idencuesta + pp_4, design = .) %>%
as.data.frame() %>%
group_by(ola, pp_4) %>%
mutate(prop = Freq/sum(Freq, na.rm = TRUE)) %>%
ungroup() %>%
filter(Freq > 0) %>%
ggplot(aes(y = prop, x = ola, fill = fct_rev(pos_id),
stratum = fct_rev(pos_id), alluvium = idencuesta)) +
theme_bw() +
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0, width = .55) +
scale_y_continuous(labels = scales::percent) +
facet_wrap(~ pp_4) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1) +
geom_text(data = function(x) { group_by(.data = x, ola, pos_id, pp_4) %>%
summarise(prop = sum(prop, na.rm = TRUE), idencuesta = 1) %>%
ungroup()},
aes(label = scales::percent(prop, accuracy = .1)),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 3,
color = rep(c('white', 'white', 'white',
'black', 'black', 'black'), 8)[-42:-48]) +
guides(fill = guide_legend(reverse = TRUE)) +
ggtitle('Intención de voto en plebiscito de entrada y salida')
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = (t11_01 + t11_02 + t11_03 + t11_04)/4,
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces",
"Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola) %>%
prop(barrio_confli_rec == 'Muchas veces o siempre',
by = ola, na.rm = TRUE)
?row_means
dat <- data.frame(
c1 = c(1,2,NA,4),
c2 = c(NA,2,NA,5),
c3 = c(NA,4,NA,NA),
c4 = c(2,3,7,8),
c5 = c(1,7,5,3)
)
dat
row_means(dat)
row_means(dat, n = 1)
row_means(dat, n = 0)
row_means(dat, n = 1)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = sjmisc::row_means(t11_01, t11_02,  t11_03, t11_04, n = 0),
barrio_confli_rec = factor(cut(barrio_confli, breaks = 0:5),
labels = 1:5))
?row_means
?rowMeans
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = rowMeans(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE),
barrio_confli_rec = factor(cut(barrio_confli, breaks = 0:5),
labels = 1:5))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = rowMeans(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE),
barrio_confli_rec = factor(cut(barrio_confli, breaks = 0:5),
labels = 1:5)) %>%
prop(barrio_confli_rec)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = rowMeans(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE),
barrio_confli_rec = factor(cut(barrio_confli, breaks = 0:5),
labels = 1:5)) %>%
prop(barrio_confli_rec)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = factor(cut(barrio_confli, breaks = 0:5),
labels = 1:5)) %>%
prop(barrio_confli_rec)
?cut
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5,
labels = 1:5)) %>%
prop(barrio_confli_rec)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5,
labels = 1:5)) %>%
prop(barrio_confli_rec)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5,
labels = 1:5)) %>%
prop(barrio_confli_rec, na.rm = TRUE)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 1:5,
labels = 1:5)) %>%
prop(barrio_confli_rec, na.rm = TRUE)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 1:5,
labels = 1:5)) %>%
ggplot(aes(y = barrio_confli_rec, x = ola)) +
geom_plot()
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5,
labels = 1:5)) %>%
ggplot(aes(y = barrio_confli_rec, x = ola)) +
geom_plot()
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5,
labels = 1:5)) %>%
ggplot(aes(y = barrio_confli_rec, x = ola)) +
geom_point()
barrio_confli_rec = cut(barrio_confli, breaks = 0:5) %>%
geom_point()
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5)) %>%
ggplot(aes(y = barrio_confli_rec, x = ola)) +
geom_point()
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = ifelse(is_nsnr(t11_01), NA, t11_01) +
ifelse(is_nsnr(t11_02), NA, t11_02) +
ifelse(is_nsnr(t11_03), NA, t11_03) +
ifelse(is_nsnr(t11_04), NA, t11_04) /
sum(!is_nsnr(t11_01) + !is_nsnr(t11_02) +
!is_nsnr(t11_03) + !is_nsnr(t11_04)),
barrio_confli_rec = cut(barrio_confli, breaks = 0:5)) %>%
ggplot(aes(y = barrio_confli, x = ola)) +
geom_point()
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33) & !is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = (t11_01 + t11_02 + t11_03 + t11_04)/4,
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola) %>%
prop(x = barrio_confli_rec, by = ola, na.rm = TRUE) %>%
ggplot(aes(y = prop, x = ola, fill = fct_rev(barrio_confli_rec),
label = as.character(scales::percent(prop, accuracy = .1)))) +
theme_bw() +
geom_col(position = 'Stack') +
ylab(label = NULL) +
xlab(label = NULL) +
scale_fill_viridis_d(end = .85) +
ggtitle(label = 'Conflictos barriales, según ola',
subtitle = 'Porcentaje que presenta Molestia o incomodidad por problemas con sus vecinos') +
guides(fill = guide_legend(reverse = TRUE)) +
geom_text(position = position_stack(vjust = .5),
size = 3,
color = rep(c('black', 'white', 'white'), 6)) +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank())
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = (t11_01 + t11_02 + t11_03 + t11_04)/4,
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre")),
voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
sjlabelled::as_label(ola) %>%
prop(barrio_confli_rec == 'Muchas veces o siempre',
by = c(ola, voto_salida), na.rm = TRUE) %>%
filter(!is.na(voto_salida)) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(size = 3) +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent,
limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = 0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Conflictividad barrial alta, según ola y voto en plebiscito de salida',
subtitle = 'Porcentaje que Muchas veces o siempre presenta Molestia o incomodidad por\nproblemas con sus vecinos')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = (t11_01 + t11_02 + t11_03 + t11_04)/4,
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre")),
voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros")),
zona = factor(case_when(region_cod %in% c(1:4, 15) ~ 'Norte',
region_cod %in% c(5:8, 16) ~ 'Centro',
region_cod %in% c(9:12, 14) ~ 'Sur',
region_cod == 13 ~ 'Metropolitana'))) %>%
prop(barrio_confli_rec == 'Muchas veces o siempre',
by = c(ola, voto_salida, zona), na.rm = T)  %>%
filter(!is.na(voto_salida)) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
facet_wrap(~zona) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = 0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Conflictividad barrial alta, según ola y  zona geográfica',
subtitle = 'Porcentaje que Muchas veces o siempre presenta Molestia o incomodidad por\nproblemas con sus vecinos')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(tipo_atricion %in% c(1, 33),
!is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(barrio_confli = (t11_01 + t11_02 + t11_03 + t11_04)/4,
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre")),
voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros")),
zona = factor(case_when(region_cod %in% c(1:4, 15) ~ 'Norte',
region_cod %in% c(5:8, 16) ~ 'Centro',
region_cod %in% c(9:12, 14) ~ 'Sur',
region_cod == 13 ~ 'Metropolitana'))) %>%
prop(barrio_confli_rec == 'Muchas veces o siempre',
by = c(ola, voto_salida, zona), na.rm = T)  %>%
filter(!is.na(voto_salida)) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
facet_wrap(~zona) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = 0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Conflictividad barrial alta, según ola y  zona geográfica',
subtitle = 'Porcentaje que Muchas veces o siempre presenta Molestia o incomodidad por\nproblemas con sus vecinos')
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% 1 & !is_nsnr(t09_02)) %>%
mutate(t09_02 = factor(car::recode(t09_02, "1 = 1; 2:3 = 2; 4:5 = 3"),
levels = 1:3,
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola) %>%
prop(x = t09_02, by = ola, na.rm = TRUE) %>%
ggplot(aes(y = prop, x = ola, fill = fct_rev(t09_02),
label = as.character(scales::percent(prop, accuracy = .1)))) +
theme_bw() +
geom_col(position = 'Stack') +
ylab(label = NULL) +
xlab(label = NULL) +
scale_fill_viridis_d(end = .85) +
ggtitle(label = 'Criminalidad barrial, según ola',
subtitle = 'Frecuencia con que se han producido robos o asaltos en su barrio') +
guides(fill = guide_legend(reverse = TRUE)) +
geom_text(position = position_stack(vjust = .5),
size = 3,
color = rep(c('black', 'white', 'white'), 6)) +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank())
?row_count
?rowsum
?rowMeans
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33) & !is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = rowMeans(t11_01, t11_02, t11_03, t11_04, na.rn = TRUE))
sjmisc::row_means()
?> sjmisc::row_means()
?sjmisc::row_means
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33) & !is_nsnr(t11_01, t11_02, t11_03, t11_04)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(t11_01, t11_02, t11_03, t11_04, na.rn = TRUE))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(t11_01, t11_02, t11_03, t11_04, na.rn = TRUE))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(t11_01, t11_02, t11_03, t11_04, n = 0))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(., t11_01, t11_02, t11_03, t11_04, n = 0))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(., t11_01, t11_02, t11_03, t11_04, n = 0),
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola) %>%
prop(x = barrio_confli_rec, by = ola, na.rm = TRUE)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(., t11_01, t11_02, t11_03, t11_04, n = 0),
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola) %>%
prop(x = barrio_confli_rec, by = ola, na.rm = TRUE)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(., t11_01, t11_02, t11_03, t11_04, n = 0),
barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04),
barrio_confli = sjmisc::row_means(., t11_01, t11_02, t11_03, t11_04, n = 0)) %>%
pull(barrio_confli)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = sum(t11_01, t11_02, t11_03, t11_04))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = mean(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = sum(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = sum(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE) /
sum(!is.na(t11_01), !is.na(t11_02), !is.na(t11_03), !is.na(t11_04)))
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = sum(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE) /
sum(!is.na(t11_01), !is.na(t11_02), !is.na(t11_03), !is.na(t11_04))) %>%
pull(barrio_confli)
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = sum(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE) /
sum(!is.na(t11_01), !is.na(t11_02), !is.na(t11_03), !is.na(t11_04))) %>%
ungroup()
elsoc_long_2016_2022 %>%
filter(tipo_atricion %in% c(1, 33)) %>%
mutate(t11_01 = ifelse(is_nsnr(t11_01), NA, t11_01),
t11_02 = ifelse(is_nsnr(t11_02), NA, t11_02),
t11_03 = ifelse(is_nsnr(t11_03), NA, t11_03),
t11_04 = ifelse(is_nsnr(t11_04), NA, t11_04)) %>%
rowwise() %>%
mutate(barrio_confli = sum(t11_01, t11_02, t11_03, t11_04, na.rm = TRUE) /
sum(!is.na(t11_01), !is.na(t11_02), !is.na(t11_03), !is.na(t11_04))) %>%
ungroup() %>%
mutate(barrio_confli_rec = factor(cut(barrio_confli, breaks = c(0, 1, 2.75, 5)),
labels = c("Nunca", "Pocas o algunas veces", "Muchas veces o siempre"))) %>%
sjlabelled::as_label(ola)
