filter(tipo_atricion == 1 | tipo_atricion == 33)
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida)) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .2, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .33, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16), !is.na(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(c06_05), !is.na(c06_05)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(c06_05 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia Mapuches, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en Mapuches')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(c06_05), !is.na(c06_05)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(c06_05 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia Mapuches, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o Poca confianza en Mapuches')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16), !is.na(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
sjmisc::frq(elsoc_long_2016_2022$region)
sjmisc::frq(elsoc_long_2016_2022$region_cod)
rm(list=ls())
library(knitr)
library(tidyverse)
library(sjmisc)
library(sjlabelled)
library(ggrepel)
library(ggalluvial)
library(survey)
library(elsoc)
library(lubridate)
library(viridis)
library(statar)
load(file.path('..', 'inputs', 'ELSOC_Long_2016_2022_v1.00_R.RData'))
load(file.path('..', 'inputs', 'ELSOC_Wide_2016_2022_v1.00_R.RData'))
voto_salida <- elsoc_long_2016_2022 %>%
filter(ola == 6) %>%
mutate(voto_salida = case_when(c55 == 4 ~ 5,
c55 %in% 1:3 ~ c55,
c55 %in% -666:-999 ~ 5,
c56 %in% -666:-999 ~ 5,
c56 == 2 ~ 4,
c57 %in% 1:3 ~ c57,
c57 %in% -666:-999 ~ 5
))  %>%
select(idencuesta, voto_salida)
elsoc_long$zona1  <- car::recode(elsoc_long$region,"c('Tarapaca','Antofagasta','Atacama','Coquimbo','Arica')= 1;c('Valparaiso','Lib. Gral. B. Ohiggins','B. Ohiggins', 'Maule','Bio Bio')= 2;c('Araucania','Los Lagos','Aysen','Magallanes','Los Rios')=3 ;'Metropolitana'= 4")
sjmisc::frq(elsoc_long_2016_2022$region_cod)
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros")),
zona = factor(case_when(region_cod %in% c(1:4, 15) ~ 'Norte',
region_cod %in% c(5:8, 16) ~ 'Centro',
region_cod %in% c(9:12, 14) ~ 'Sur',
region_cod == 13 ~ 'Metropolitana'))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida, zona), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
facet_wrap(~zona) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida y zona geográfica',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16), !is.na(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros")),
zona = factor(case_when(region_cod %in% c(1:4, 15) ~ 'Norte',
region_cod %in% c(5:8, 16) ~ 'Centro',
region_cod %in% c(9:12, 14) ~ 'Sur',
region_cod == 13 ~ 'Metropolitana'))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida, zona), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_wrap(~zona) +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16), !is.na(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros")),
zona = factor(case_when(region_cod %in% c(1:4, 15) ~ 'Norte',
region_cod %in% c(5:8, 16) ~ 'Centro',
region_cod %in% c(9:12, 14) ~ 'Sur',
region_cod == 13 ~ 'Metropolitana'))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida, zona), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
facet_wrap(~zona) +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .75)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(r16), !is.na(r16)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros")),
zona = factor(case_when(region_cod %in% c(1:4, 15) ~ 'Norte',
region_cod %in% c(5:8, 16) ~ 'Centro',
region_cod %in% c(9:12, 14) ~ 'Sur',
region_cod == 13 ~ 'Metropolitana'))) %>%
prop(r16 %in% 1:2, by = c(ola, voto_salida, zona), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
facet_wrap(~zona) +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .8)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Desconfianza hacia inmigrantes, según voto en plebiscito de salida',
subtitle = 'Porcentaje con Nada o poca confianza en inmigrantes')
elsoc_long_2016_2022 %>%
left_join(voto_salida, by = 'idencuesta') %>%
sjlabelled::as_label(ola) %>%
filter(!is_nsnr(t10)) %>%
mutate(voto_salida = factor(car::recode(voto_salida, "1 = 1; 2 = 2; 3:5 = 3"),
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Otros"))) %>%
prop(t10 %in% 1:2, by = c(ola, voto_salida), na.rm = T)  %>%
filter(!is.na(voto_salida), voto_salida %in% c('Apruebo', 'Rechazo')) %>%
ggplot(aes(y = prop, x = ola, color = voto_salida, group = voto_salida,
label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_text_repel(nudge_y = .01, size = 3, color = 'black') +
geom_point(size = 1.75) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .5)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(begin = .1, end = .66, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('Percepción de inseguridad barrial, según voto en plebiscito de salida',
subtitle = 'Porcentaje que se siente Inseguro o Muy Inseguro en su barrio')
