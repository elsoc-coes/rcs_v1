mutate(pp_3 = factor(pp_3,
labels = c("Votante\nHabitual", "No Votante", "Votante\nReactivo"))) %>%
prop(m0_edad, by = pp_3, na.rm = TRUE) %>%
ggplot(aes(x = prop, y = fct_rev(pp_3), fill = fct_rev(m0_edad),
label = scales::percent(prop, .1))) +
geom_bar(stat = 'identity', position = 'stack') +
labs(y = NULL, x = NULL, title = NULL, fill = NULL) +
scale_x_continuous(labels = scales::percent) +
guides(fill = guide_legend(reverse = TRUE)) +
geom_text(position = position_stack(vjust = .5), size = 3,
color = rep(c('black', 'black', 'white', 'white'), 3)) +
theme_bw() +
scale_fill_viridis_d(begin = 0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
axis.text.x = element_text(size = rel(.9)),
legend.position = 'top',
legend.title = element_blank()) +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos)')
elsoc_long_2016_2022 %>%
filter(tipo_atricion == 1) %>%
filter(ola == 6) %>%
filter(!is.na(m01), !is.na(pp_3)) %>%
mutate(m01 = factor(car::recode(m01, recodes = "1:3 = 1; 4:5 = 2; 6:7 = 3; 8:10 = 4"),
levels = 1:4,
labels = c("Básica", "Media", "Técnica", "Universitaria"))) %>%
mutate(pp_3 = factor(pp_3,
labels = c("Votante\nHabitual", "No Votante", "Votante\nReactivo"))) %>%
prop(m01, by = pp_3, na.rm = TRUE) %>%
ggplot(aes(x = prop, y = fct_rev(pp_3), fill = fct_rev(m01),
label = scales::percent(prop, .1))) +
geom_bar(stat = 'identity', position = 'stack') +
labs(y = NULL, x = NULL, title = NULL, fill = NULL) +
scale_x_continuous(labels = scales::percent) +
guides(fill = guide_legend(reverse = TRUE)) +
geom_text(position = position_stack(vjust = .5), size = 3,
color = rep(c('black', 'black', 'white', 'white'), 3)) +
theme_bw() +
scale_fill_viridis_d(begin = 0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
axis.text.x = element_text(size = rel(.9)),
legend.position = 'top',
legend.title = element_blank()) +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos)')
elsoc_long_2016_2022 %>%
filter(tipo_atricion == 1) %>%
mutate(clase_subj = factor(car::recode(c33, recodes = "1:2 = 1; 3 = 2; 3:4 = 3"),
levels = 1:3,
labels = c("Clase baja", "Clase media", "Clase alta")),
pp_3 = factor(pp_3,
labels = c("Votante\nHabitual", "No Votante", "Votante\nReactivo")),
m30 = as.numeric(car::recode(m30, "1 = 110000; 2 = 251000; 3 = 305000; 4 = 355000; 5 = 400000; 6 = 445000; 7 = 490000; 8 = 535000; 9 = 585000; 10 = 640000; 11 = 700000; 12 = 765000; 13 = 845000; 14 = 935000; 15 = 1040000; 16 = 1180000; 17 = 1375000; 18 = 1670000; 19 = 2275000; 20 = 2700000; -666:-999 = NA; NA = NA")),
m30b = as.numeric(car::recode(m30b, "1 = 170000; 2 = 300000; 3 = 400000; 4 = 600000; 5 = 1200000; -666:-999 = NA; NA = NA")),
m29_imp = case_when(is_nsnr(m29) & !is.na(m30) ~ m30,
is_nsnr(m29) & !is.na(m30b) ~ m30b,
TRUE ~ m29),
nhogar = case_when(ola == 1 ~ nhogar1,
ola == 2 ~ m46_nhogar,
TRUE ~ m54),
nhogar = ifelse(is_nsnr(nhogar), NA, nhogar)) %>%
group_by(idencuesta) %>%
mutate(nhogar = ifelse(is.na(nhogar), lag(nhogar), nhogar)) %>%
ungroup() %>%
group_by(ola) %>%
mutate(ypc = m29_imp / nhogar,
decil = xtile(ypc, n = 10, wt = ponderador02),
clase_ingreso = factor(car::recode(decil, "1:4 = 1; 5:9 = 2; 10 = 3"),
levels = 1:3,
labels = c('Clase baja', 'Clase media', 'Clase alta'))
) %>%
ungroup() %>%
filter(ola == 6) %>%
prop_list(clase_ingreso, clase_subj, by = pp_3, na.rm = TRUE) %>%
filter(!is.na(pp_3)) %>%
mutate(name = factor(name,
levels = c('clase_ingreso', 'clase_subj'),
labels = c('Clase social según ingresos', 'Clase social subjetiva'))) %>%
ggplot(aes(x = prop, y = fct_rev(pp_3), fill = fct_rev(value),
label = scales::percent(prop, .1))) +
geom_bar(stat = 'identity', position = 'stack') +
facet_wrap(~name) +
labs(y = NULL, x = NULL, title = NULL, fill = NULL) +
scale_x_continuous(labels = scales::percent) +
guides(fill = guide_legend(reverse = TRUE)) +
geom_text(position = position_stack(vjust = .5), size = 3,
color = rep(rep(c('black', 'white', 'white'), 3), 2)) +
theme_bw() +
scale_fill_viridis_d(begin = 0, end = .8, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
axis.text.x = element_text(size = rel(.9)),
legend.position = 'top',
legend.title = element_blank()) +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota 1: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos). \nNota 2: Clase social según ingresos fue construida según deciles de ingreso per cápita del hogar. Deciles 1-4 \ncorresponden a clase baja, deciles 5-9 a clase media y decil 10 a clase alta.')
elsoc_long_2016_2022 %>%
filter(tipo_atricion == 1) %>%
filter(ola == 6) %>%
mutate(salida = factor(salida,
levels = 1:5,
labels = c("Apruebo", "Rechazo", "Nulo/Blanco",
"No vota", "NS/NR"))) %>%
prop(salida, na.rm = T) %>%
ggplot(aes(y = prop, x = salida, label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_col(fill = viridis(1, begin = .33)) +
geom_text(position = position_dodge(.9), vjust = -.5, size = 3) +
scale_y_continuous(labels = scales::percent,
limits = c(0,1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(end = .66, direction = 1, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('', subtitle = 'Porcentaje que votó...') +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota 1: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos). \nNota 2: El gráfico incluye a la muestra encuestada pre y post-plebiscito. La opción no vota solo fue incorporada\npost-plebiscito como voto retrospectivo.')
rm(list=ls())
library(knitr)
library(tidyverse)
library(sjmisc)
library(sjlabelled)
library(ggrepel)
library(ggalluvial)
library(survey)
library(elsoc)
library(lubridate)
library(viridis)
library(statar)
library(tidyverse)
options(dplyr.summarise.inform = FALSE)
load(file.path('..', 'inputs', 'ELSOC_Long.RData'))
load(file.path('..', 'inputs', 'ELSOC_Wide.RData'))
elsoc_long.0 <- elsoc_long_2016_2022
elsoc_long_2016_2022 <- elsoc_long.0 %>%
mutate(pleb = case_when(c55 == 4 ~ 5,
c55 == 1 ~ 1,
c55 == 2 ~ 2,
c55 == 3 ~ 3,
c55 == -999 ~ 5,
c55 == -888 ~ 5,
c55 == -777 ~ 5,
c55 == -666 ~ 5,
c56 == -999 ~ 5,
c56 == -888 ~ 5,
c56 == -777 ~ 5,
c56 == -666 ~ 5,
c56 == 2 ~ 4,
c57 == 1 ~ 1,
c57 == 2 ~ 2,
c57 == 3 ~ 3,
c57 == -999 ~ 5,
c57 == -888 ~ 5,
c57 == -777 ~ 5,
c57 == -666 ~ 5))  %>%
group_by(idencuesta) %>%
mutate(salida = ifelse(length(na.omit(pleb)) == 0, NA, max(pleb, na.rm = T))) %>%
ungroup()
load(file.path('..', 'inputs', 'perfiles.RData'))
elsoc_long_2016_2022 <- elsoc_long_2016_2022 %>%
left_join(perfiles, by = "idencuesta") %>%
mutate(pp_3 = factor(pp_3,
levels = 1:3,
labels = c("Votante Habitual (70.3%)", "No Votante (17.3%)", "Votante Reactivo (12.3%)"))) %>%
mutate(pp_4 = factor(pp_4,
levels = 1:4,
labels = c("1 (10.90%)", "2 (8.29%)", " 3 (69.28%)", "4 (11.53%)"))) %>%
mutate(pp_5 = factor(pp_5,
levels = 1:5,
labels = c("1 (10.90%)", "2 (10.78%)", "3 (57.75%)",
"4 (5.34%)", "5 (15.24%)")))
elsoc_wide_2016_2022 <- elsoc_wide_2016_2022 %>%
left_join(perfiles, by = "idencuesta") %>%
mutate(pp_3 = factor(pp_3,
levels = 1:3,
labels = c("Votante Habitual (70.3%)", "No Votante (17.3%)", "Votante Reactivo (12.3%)"))) %>%
mutate(pp_4 = factor(pp_4,
levels = 1:4,
labels = c("1 (10.90%)", "2 (8.29%)", " 3 (69.28%)", "4 (11.53%)"))) %>%
mutate(pp_5 = factor(pp_5,
levels = 1:5,
labels = c("1 (10.90%)", "2 (10.78%)", "3 (57.75%)",
"4 (5.34%)", "5 (15.24%)")))
elsoc_long_2016_2022 %>%
filter(tipo_atricion == 1) %>%
filter(ola == 6) %>%
mutate(salida = factor(salida,
levels = 1:5,
labels = c("Apruebo", "Rechazo", "Nulo/Blanco",
"No vota", "NS/NR"))) %>%
prop(salida, na.rm = T) %>%
ggplot(aes(y = prop, x = salida, label = scales::percent(prop, accuracy = .1))) +
theme_bw() +
geom_col(fill = viridis(1, begin = .33)) +
geom_text(position = position_dodge(.9), vjust = -.5, size = 3) +
scale_y_continuous(labels = scales::percent,
limits = c(0,1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(end = .66, direction = 1, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
ggtitle('', subtitle = 'Porcentaje que votó...') +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota 1: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos). \nNota 2: El gráfico incluye a la muestra encuestada pre y post-plebiscito. La opción no vota solo fue incorporada\npost-plebiscito como voto retrospectivo.')
rm(list=ls())
library(knitr)
library(tidyverse)
library(sjmisc)
library(sjlabelled)
library(ggrepel)
library(ggalluvial)
library(survey)
library(elsoc)
library(lubridate)
library(viridis)
library(statar)
library(tidyverse)
options(dplyr.summarise.inform = FALSE)
load(file.path('..', 'inputs', 'ELSOC_Long.RData'))
load(file.path('..', 'inputs', 'ELSOC_Wide.RData'))
elsoc_long.0 <- elsoc_long_2016_2022
elsoc_long_2016_2022 <- elsoc_long.0 %>%
mutate(pleb = case_when(c55 == 4 ~ 5,
c55 == 1 ~ 1,
c55 == 2 ~ 2,
c55 == 3 ~ 3,
c55 == -999 ~ 5,
c55 == -888 ~ 5,
c55 == -777 ~ 5,
c55 == -666 ~ 5,
c56 == -999 ~ 5,
c56 == -888 ~ 5,
c56 == -777 ~ 5,
c56 == -666 ~ 5,
c56 == 2 ~ 4,
c57 == 1 ~ 1,
c57 == 2 ~ 2,
c57 == 3 ~ 3,
c57 == -999 ~ 5,
c57 == -888 ~ 5,
c57 == -777 ~ 5,
c57 == -666 ~ 5))  %>%
group_by(idencuesta) %>%
mutate(salida = ifelse(length(na.omit(pleb)) == 0, NA, max(pleb, na.rm = T))) %>%
ungroup()
load(file.path('..', 'inputs', 'perfiles.RData'))
elsoc_long_2016_2022 <- elsoc_long_2016_2022 %>%
left_join(perfiles, by = "idencuesta") %>%
mutate(pp_3 = factor(pp_3,
levels = 1:3,
labels = c("Votante Habitual (70.3%)", "No Votante (17.3%)", "Votante Reactivo (12.3%)"))) %>%
mutate(pp_4 = factor(pp_4,
levels = 1:4,
labels = c("1 (10.90%)", "2 (8.29%)", " 3 (69.28%)", "4 (11.53%)"))) %>%
mutate(pp_5 = factor(pp_5,
levels = 1:5,
labels = c("1 (10.90%)", "2 (10.78%)", "3 (57.75%)",
"4 (5.34%)", "5 (15.24%)")))
elsoc_wide_2016_2022 <- elsoc_wide_2016_2022 %>%
left_join(perfiles, by = "idencuesta") %>%
mutate(pp_3 = factor(pp_3,
levels = 1:3,
labels = c("Votante Habitual (70.3%)", "No Votante (17.3%)", "Votante Reactivo (12.3%)"))) %>%
mutate(pp_4 = factor(pp_4,
levels = 1:4,
labels = c("1 (10.90%)", "2 (8.29%)", " 3 (69.28%)", "4 (11.53%)"))) %>%
mutate(pp_5 = factor(pp_5,
levels = 1:5,
labels = c("1 (10.90%)", "2 (10.78%)", "3 (57.75%)",
"4 (5.34%)", "5 (15.24%)")))
elsoc_long_2016_2022 %>%
filter(tipo_atricion == 1, ola %in% 5:6) %>%
mutate(salida = factor(car::recode(salida, "1 = 1; 2 = 2; 3:5 = 3"))) %>%
mutate(c44 = case_when(c44 == 1 ~ 1,
c44 == 2 ~ 2,
c44 == 3 ~ 3,
c44 == 4 ~ 3,
c44 == -999 ~ 3,
c44 == -888 ~ 3,
c44 == -777 ~ 3,
c44 == -666 ~ 3,
c43 == 2 ~ 3,
c43 == 3 ~ 3,
c43 == -999 ~ 3,
c43 == -888 ~ 3,
c43 == -777 ~ 3,
c43 == -666 ~ 3))  %>%
mutate(pos_id = ifelse(!is.na(c44), c44, salida),
pos_id = factor(pos_id,
levels = 1:3,
labels = c("Apruebo", "Rechazo", "Indeciso o\nno vota")),
ola = factor(ola,
levels = 5:6,
labels = c("Plebiscito de\nEntrada\n2020",
"Plebiscito de\nSalida\n2022"))) %>%
survey_design_elsoc() %>%
svytable(~ pos_id + ola + idencuesta, design = .) %>%
as.data.frame() %>%
group_by(ola) %>%
mutate(prop = Freq/sum(Freq, na.rm = TRUE)) %>%
ungroup() %>%
filter(Freq > 0) %>%
ggplot(aes(y = prop, x = ola, fill = fct_rev(pos_id),
stratum = fct_rev(pos_id), alluvium = idencuesta)) +
theme_bw() +
ggalluvial::geom_flow(alpha = .66) +
ggalluvial::geom_stratum(linetype = 0, width = .55) +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = NULL) +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
scale_fill_viridis_d(direction = -1, begin = 0, end = .8, option = 'viridis') +
geom_text(data = function(x) { group_by(.data = x, ola, pos_id) %>%
summarise(prop = sum(prop, na.rm = TRUE), idencuesta = 1) %>%
ungroup()},
aes(label = scales::percent(prop, accuracy = .1)),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 3,
color = c('white', 'white', 'black',
'white', 'white', 'black')) +
guides(fill = guide_legend(reverse = TRUE)) +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota 1: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos). \nNota 2: Categoría indeciso o no vota incluye a quienes no votaron, no sabe, no responde, nulos y blancos.')
elsoc_wide_2016_2022 %>%
filter(tipo_atricion == 1) %>%
filter(!is.na(pp_3)) %>%
mutate(pp_3 = factor(pp_3,
labels = c("Votante Habitual", "No Votante", "Votante Reactivo"))) %>%
mutate(pos_id_w04 = factor(car::recode(c15_w04, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; c(11, 12, -888, -999, -777, -666) = 4"),
levels = c(1, 2, 3, 4),
labels = c('Izq.', "Centro", "Der.", "No se\nidentifica")),
pos_id_w06 = factor(car::recode(c15_w06, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; c(11, 12, -888, -999, -777, -666) = 4"),
levels = c(1, 2, 3, 4),
labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
survey_design_elsoc(weights = 'ponderador02_w06') %>%
prop(pos_id_w06, by = c(pp_3, pos_id_w04), na.rm = TRUE) %>%
ggplot(aes(y = prop, x = pos_id_w04, fill = fct_rev(pos_id_w06),
label = scales::percent(prop, accuracy = .1))) +
facet_wrap(~ pp_3) +
theme_bw() +
geom_col(position = 'stack') +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = 'Posición política en 2019') +
scale_fill_viridis_d(end = .8, option = 'viridis') +
geom_text(position = position_stack(vjust = .5),
size = 3,
color = rep(c('black', 'black', 'white', 'white'), 12)) +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top') +
labs(fill = 'Posición política en 2022') +
guides(fill = guide_legend(reverse = TRUE))
elsoc_wide_2016_2022 %>%
filter(tipo_atricion == 1) %>%
filter(!is.na(pp_3)) %>%
mutate(pp_3 = factor(pp_3,
labels = c("Votante Habitual", "No Votante", "Votante Reactivo"))) %>%
mutate(pos_id_w04 = factor(car::recode(c15_w04, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; c(11, 12, -888, -999, -777, -666) = 4"),
levels = c(1, 2, 3, 4),
labels = c('Izq.', "Centro", "Der.", "No se\nidentifica")),
pos_id_w06 = factor(car::recode(c15_w06, recodes = "0:4 = 1; 5 = 2; 6:10 = 3; c(11, 12, -888, -999, -777, -666) = 4"),
levels = c(1, 2, 3, 4),
labels = c('Izquierda', "Centro", "Derecha", "No se identifica"))) %>%
survey_design_elsoc(weights = 'ponderador02_w06') %>%
prop(pos_id_w06, by = c(pp_3, pos_id_w04), na.rm = TRUE) %>%
ggplot(aes(y = prop, x = pos_id_w04, fill = fct_rev(pos_id_w06),
label = scales::percent(prop, accuracy = .1))) +
facet_wrap(~ pp_3) +
theme_bw() +
geom_col(position = 'stack') +
scale_y_continuous(labels = scales::percent) +
ylab(label = NULL) +
xlab(label = 'Posición política en 2019') +
scale_fill_viridis_d(end = .8, option = 'viridis') +
geom_text(position = position_stack(vjust = .5),
size = 3,
color = rep(c('black', 'black', 'white', 'white'), 12)) +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top') +
labs(fill = 'Posición política en 2022', caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos).') +
guides(fill = guide_legend(reverse = TRUE))
library(knitr)
library(tidyverse)
library(sjmisc)
library(sjlabelled)
library(ggrepel)
library(ggalluvial)
library(survey)
library(elsoc)
library(lubridate)
library(viridis)
library(statar)
load(file.path('..', 'inputs', 'ELSOC_Long.RData'))
load(file.path('..', 'inputs', 'ELSOC_Wide.RData'))
# Voto en plebiscito de salida para agregar a toda la muestra:
voto_salida <- elsoc_long_2016_2022 %>%
filter(ola == 6) %>%
mutate(voto_salida = case_when(c55 == 4 ~ 5,
c55 %in% 1:3 ~ c55,
c55 %in% -666:-999 ~ 5,
c56 %in% -666:-999 ~ 5,
c56 == 2 ~ 4,
c57 %in% 1:3 ~ c57,
c57 %in% -666:-999 ~ 5
))  %>%
select(idencuesta, voto_salida)
# Cargar datos de perfiles:
load(file.path('..', 'inputs', 'perfiles.RData'))
perfiles0 <- perfiles
perfiles <- perfiles0 %>%
mutate(pp_3 = factor(pp_3,
levels = 1:3,
labels = c("Votante Habitual", "No Votante", "Votante Reactivo")),
pp_4 = factor(pp_4,
levels = 1:4,
labels = c("Votante\nCrónico (64.24%)", "Desafecto (8.30%)", "No Votante\nCrónico (14.28%)", "Activado (13.17%)"))) %>%
mutate(pp_5 = factor(pp_5,
levels = 1:5,
labels = c("1 (14.27%)", "2 (11.44%)", "3 (4.73%)",
"4 (6.33%)", "5 (63.24%)")))
elsoc_long_2016_2022 %>%
left_join(perfiles, by = 'idencuesta') %>%
filter(tipo_atricion == 1) %>%
as_label(ola) %>%
prop(c02 == 1, by = c(ola, pp_3), na.rm = TRUE) %>%
filter(!is.na(pp_3)) %>%
ggplot(aes(y = prop, x = ola,
color = pp_3, group = pp_3,
label = as.character(scales::percent(prop, accuracy = .1)))) +
theme_bw() +
geom_text_repel(size = 3, nudge_y = .01) +
geom_point(size = 1.75) +
geom_line() +
ggtitle(label = '',
subtitle = 'Casi siempre se puede confiar en las personas') +
scale_y_continuous(labels = scales::percent,
limits = c(0, .2)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(end = .75, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos).')
elsoc_long_2016_2022 %>%
left_join(perfiles, by = 'idencuesta') %>%
filter(tipo_atricion == 1) %>%
as_label(ola) %>%
mutate(c06_04 = car::recode(c06_04, "-666:-999 = NA"),
c06_05 = car::recode(c06_05, "-666:-999 = NA"),
c06_06 = car::recode(c06_06, "-666:-999 = NA")
) %>%
rowwise() %>%
mutate(diversidad = sum(c06_04, c06_05, c06_06, na.rm = TRUE) / sum(!is.na(c06_04), !is.na(c06_05), !is.na(c06_06))) %>%
ungroup() %>%
mutate(diversidad_rec = cut(diversidad,
breaks = c(0, 2, 3, 5),
labels = c('Baja', 'Media', 'Alta'))) %>%
prop(diversidad_rec == 'Alta', by = c(ola, pp_3), na.rm = TRUE) %>%
filter(!is.na(pp_3)) %>%
ggplot(aes(y = prop, x = ola,
color = pp_3, group = pp_3,
label = as.character(scales::percent(prop, accuracy = .1)))) +
theme_bw() +
geom_text_repel(size = 3, nudge_y = .01) +
geom_point(size = 1.75) +
geom_line() +
ggtitle(label = '',
subtitle = 'De acuerdo o totalmente de acuerdo, en promedio, con la aceptación de la diversidad') +
scale_y_continuous(labels = scales::percent,
limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(end = .75, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
labs(caption = '*Indicador construido con respuesta promedio al grado de confianza en Homosexuales, Mapuche e Inmigrantes')
elsoc_long_2016_2022 %>%
left_join(perfiles, by = 'idencuesta') %>%
filter(tipo_atricion == 1) %>%
as_label(ola) %>%
mutate(c06_04 = car::recode(c06_04, "-666:-999 = NA"),
c06_05 = car::recode(c06_05, "-666:-999 = NA"),
c06_06 = car::recode(c06_06, "-666:-999 = NA")
) %>%
rowwise() %>%
mutate(diversidad = sum(c06_04, c06_05, c06_06, na.rm = TRUE) / sum(!is.na(c06_04), !is.na(c06_05), !is.na(c06_06))) %>%
ungroup() %>%
mutate(diversidad_rec = cut(diversidad,
breaks = c(0, 2, 3, 5),
labels = c('Baja', 'Media', 'Alta'))) %>%
prop(diversidad_rec == 'Alta', by = c(ola, pp_3), na.rm = TRUE) %>%
filter(!is.na(pp_3)) %>%
ggplot(aes(y = prop, x = ola,
color = pp_3, group = pp_3,
label = as.character(scales::percent(prop, accuracy = .1)))) +
theme_bw() +
geom_text_repel(size = 3, nudge_y = .01) +
geom_point(size = 1.75) +
geom_line() +
ggtitle(label = '',
subtitle = 'De acuerdo o totalmente de acuerdo, en promedio, con la aceptación de la diversidad') +
scale_y_continuous(labels = scales::percent,
limits = c(0, 1)) +
ylab(label = NULL) +
xlab(label = NULL) +
scale_color_viridis_d(end = .75, option = 'viridis') +
theme(plot.caption = element_text(hjust = 0),
legend.position = 'top',
legend.title = element_blank()) +
labs(caption = 'Fuente: Elaboración propia en base a datos ELSOC 2016-2022.\nNota 1: Se consideran observaciones de individuos sin atrición entre olas. N=10.912 (2.076 individuos).\nNota 2: Indicador construido con respuesta promedio al grado de confianza en Homosexuales, Mapuche e Inmigrantes')
